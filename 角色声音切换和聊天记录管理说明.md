# 🎭 角色声音切换和聊天记录管理功能说明

## 🌟 新功能概览

### 1. 角色声音切换
- **luoli（可爱小萝莉）**：`Chinese (Mandarin)_ExplorativeGirl`
- **nuannan（超级暖男）**：`Chinese (Mandarin)_Stubborn_Friend`
- **youzi（孔子学生）**：`Chinese (Mandarin)_Radio_Host`

### 2. 独立聊天记录
- 每个角色都有独立的聊天记录
- 切换角色时自动加载对应的历史记录
- 聊天记录持久化保存到本地文件

### 3. 聊天日志记录
- 自动记录所有对话内容
- 按日期分类保存日志文件
- 包含时间戳、角色、用户消息、AI回复

### 4. 导入导出功能
- 一键导出所有角色的聊天记录
- 支持导入之前的聊天记录
- 保持AI对用户的记忆效果

## 🔧 技术实现

### 后端API更新

#### 角色配置
```python
AVAILABLE_ROLES = {
    "luoli": {
        "name": "可爱小萝莉",
        "voice_id": "Chinese (Mandarin)_ExplorativeGirl",
        "weight": 100
    },
    "nuannan": {
        "name": "超级暖男",
        "voice_id": "Chinese (Mandarin)_Stubborn_Friend",
        "weight": 1
    },
    "youzi": {
        "name": "孔子学生",
        "voice_id": "Chinese (Mandarin)_Radio_Host",
        "weight": 1
    }
}
```

#### 新增API端点
- `GET /roles` - 获取角色列表
- `POST /switch_role` - 切换角色并加载历史记录
- `GET /export_chat` - 导出所有角色聊天记录
- `POST /import_chat` - 导入聊天记录
- `GET /get_chat_history/<role>` - 获取指定角色历史记录
- `POST /clear_chat_history/<role>` - 清空指定角色历史记录

### 前端界面更新

#### 新增功能按钮
- **📤 导出聊天记录**：导出所有角色的聊天记录
- **📥 导入聊天记录**：导入之前的聊天记录
- **🗑️ 清空当前角色历史**：清空当前角色的聊天记录

#### 历史记录显示
- 显示当前角色的聊天记录数量
- 切换角色时自动加载历史记录
- 显示最近10条聊天记录

## 📁 文件结构

### 聊天记录存储
```
code/chat_history/
├── luoli_history.json          # 小萝莉的聊天记录
├── nuannan_history.json        # 暖男的聊天记录
├── youzi_history.json          # 孔子学生的聊天记录
└── chat_log_20250101.json     # 每日聊天日志
```

### 导出文件格式
```json
{
  "luoli": {
    "name": "可爱小萝莉",
    "voice_id": "Chinese (Mandarin)_ExplorativeGirl",
    "history": [...],
    "export_time": "2025-01-01T12:00:00"
  },
  "nuannan": {
    "name": "超级暖男",
    "voice_id": "Chinese (Mandarin)_Stubborn_Friend",
    "history": [...],
    "export_time": "2025-01-01T12:00:00"
  }
}
```

## 🎮 使用指南

### 角色切换
1. 在右侧面板选择不同的AI角色
2. 系统自动加载该角色的聊天记录
3. AI回复时使用对应角色的声音

### 聊天记录管理
1. **查看历史**：切换角色时自动显示历史记录
2. **导出记录**：点击"导出聊天记录"按钮
3. **导入记录**：点击"导入聊天记录"选择JSON文件
4. **清空记录**：点击"清空当前角色历史"按钮

### 声音效果
- **小萝莉**：活泼可爱的女声
- **暖男**：温柔体贴的男声
- **孔子学生**：沉稳博学的男声

## 🔍 功能特点

### 1. 智能记忆
- 每个角色记住与用户的对话历史
- 切换角色时保持独立的对话上下文
- 支持长期记忆管理

### 2. 数据安全
- 聊天记录本地存储
- 支持备份和恢复
- 按日期分类的日志记录

### 3. 用户体验
- 一键导出所有数据
- 简单的导入流程
- 实时显示历史记录数量

### 4. 声音个性化
- 每个角色有独特的声音特征
- 自动根据角色切换声音
- 保持角色一致性

## 🚀 启动使用

### 1. 启动系统
```bash
# 双击运行
start-voice-chat.bat
```

### 2. 访问页面
- 语音对话：http://localhost:8000/voice-chat.html

### 3. 开始使用
1. 选择AI角色
2. 开始语音对话
3. 系统自动保存聊天记录
4. 可随时导出/导入记录

## 📊 数据管理

### 导出数据
- 包含所有角色的完整聊天记录
- 包含角色配置信息
- 包含导出时间戳

### 导入数据
- 支持JSON格式文件
- 自动识别角色配置
- 保持历史记录完整性

### 日志记录
- 每日自动创建日志文件
- 记录所有对话内容
- 便于后续分析和回顾

## ⚠️ 注意事项

### 文件管理
- 聊天记录存储在 `code/chat_history/` 目录
- 定期备份重要数据
- 注意磁盘空间使用

### 角色切换
- 切换角色会清空当前显示
- 历史记录自动保存
- 声音立即切换

### 导入导出
- 导出文件包含敏感信息，请妥善保管
- 导入前请确认文件格式正确
- 建议定期导出备份

---

🎉 **现在每个AI角色都有独特的声音和独立的记忆了！**
